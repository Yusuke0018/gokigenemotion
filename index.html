<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- 
    ã”æ©Ÿå«Œãƒã‚¹ã‚¿ãƒ¼ - éèªçŸ¥è„³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒªï¼ˆãƒªãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šä¿®æ­£ç‰ˆï¼‰
    
    ã€æ¦‚è¦ã€‘
    è¾»ç§€ä¸€å…ˆç”Ÿã®ç†è«–ã«åŸºã¥ã3ã¤ã®åŸºæœ¬ç·´ç¿’ã‚’å®Ÿè·µã™ã‚‹Webã‚¢ãƒ—ãƒª
    - æ„Ÿæƒ…ã«æ°—ã¥ãï¼ˆå¿«ãƒ»ä¸å¿«ï¼‰
    - ã”æ©Ÿå«Œã®ä¾¡å€¤ã‚’çŸ¥ã‚‹
    - ä»Šã“ã“è‡ªåˆ†ã‚’æ„è­˜ã™ã‚‹
    
    ã€ãƒ‡ã‚¶ã‚¤ãƒ³ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€‘
    æ¸©ã‹ã¿ã®ã‚ã‚‹è‰²èª¿ã¨æ´—ç·´ã•ã‚ŒãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€
    å¿ƒåœ°ã‚ˆã„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§æ¯æ—¥ã®è¨˜éŒ²ã‚’æ¥½ã—ãã‚µãƒãƒ¼ãƒˆ
    
    ã€ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€‘
    localStorageã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–
    é€±æ¬¡ã§è‡ªå‹•ãƒªã‚»ãƒƒãƒˆã€éå»ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜

    ã€ä¸»ãªä¿®æ­£ç‚¹ã€‘
    1. Web App Manifestã®ä¿®æ­£ï¼šã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ãŸéš›ã®ã‚¢ãƒ—ãƒªåãŒæ–‡å­—åŒ–ã‘ã™ã‚‹å•é¡Œã‚’ä¿®æ­£ã€‚
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>ã”æ©Ÿå«Œãƒã‚¹ã‚¿ãƒ¼</title>

    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ã¨PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆè¨­å®š (ä¿®æ­£ç‰ˆ) -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://placehold.co/180x180/ff6b6b/ffffff?text=%F0%9F%98%8A&font=noto">
    <link rel="icon" type="image/png" sizes="32x32" href="https://placehold.co/32x32/ff6b6b/ffffff?text=%F0%9F%98%8A&font=noto">
    <link rel="icon" type="image/png" sizes="192x192" href="https://placehold.co/192x192/ff6b6b/ffffff?text=%F0%9F%98%8A&font=noto">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoi44GT5qGl5qCF44Oe44K544K/44O8Iiwic2hvcnRfbmFtZSI6IuOBk+ahpeahheODnueCuei/vOODvCIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWExYTJlIiwidGhlbWVfY29sb3IiOiIjMWExYTJlIiwiZGVzY3JpcHRpb24iOiLmmL/loLFzaOODhOODs+ODiOOCouODvOODiOOBk+ahpeahheOBjOODvOOCouODg+ODlOODqyIsImljb25zIjpbeyJzcmMiOiJodHRwczovL3BsYWNlaG9sZC5jby8xOTJ4MTkyL2ZmNmI2Yi9mZmZmZmY/dGV4dD0lRjAlOUYlOTglOUEmZm9udD1ub3RvIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly9wbGFjZWtoZ3VsZC5jby81MTJ4NTEyL2ZmNmI2Yi9mZmZmZmY/dGV4dD0lRjAlOUYlOTglOUEmZm9udD1ub3RvIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap');

        :root {
            --primary: #ff6b6b;
            --primary-light: #ff8787;
            --primary-dark: #ee5a5a;
            --secondary: #4ecdc4;
            --accent: #ffe66d;
            --background: #1a1a2e;
            --surface: #16213e;
            --surface-light: #0f3460;
            --surface-lighter: #1e3a5f;
            --text: #f5f5f5;
            --text-dim: #a8a8a8;
            --success: #51cf66;
            --warning: #ff6b6b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warm: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Zen Maru Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 230, 109, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
            position: relative;
        }

        .header::after {
            content: 'âœ¨';
            position: absolute;
            top: -10px;
            right: 20%;
            font-size: 1.5rem;
            animation: sparkle 2s ease-in-out infinite;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient-warm);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: 0.02em;
            text-shadow: 2px 2px 20px rgba(255, 107, 107, 0.3);
        }

        .header p {
            color: var(--text-dim);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .navigation {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 15px;
            background: rgba(30, 58, 95, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .nav-button {
            flex: 1;
            padding: 14px 20px;
            background: var(--surface);
            border: 2px solid transparent;
            border-radius: 15px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.95rem;
            font-weight: 500;
            min-width: 90px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 107, 107, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .nav-button:hover::before {
            width: 100%;
            height: 100%;
        }

        .nav-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.2);
        }

        .nav-button.active {
            background: var(--gradient-warm);
            color: white;
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4);
            transform: translateY(-2px);
        }

        .section {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .section.active {
            display: block;
        }

        .card {
            background: var(--surface);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: slideUp 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-warm);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 0.1;
        }

        .card h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: 'ğŸ¯';
            font-size: 1.5rem;
        }

        .emotion-main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .emotion-button {
            padding: 50px;
            font-size: 3.5rem;
            background: var(--surface-light);
            border: 3px solid transparent;
            border-radius: 20px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            backdrop-filter: blur(5px);
        }
        .emotion-button > span {
            font-size: 1.6rem;
            margin-top: 10px;
            display: block;
        }

        .emotion-button::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .emotion-button:hover::after {
            opacity: 1;
        }

        .emotion-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
            border-color: var(--secondary);
        }

        .emotion-button.selected {
            background: var(--gradient-warm);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
            transform: scale(1.05);
        }

        .emotion-button.selected::after {
            opacity: 1;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text);
            font-weight: 500;
            font-size: 1.05rem;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 15px 20px;
            background: rgba(15, 52, 96, 0.5);
            border: 2px solid var(--surface-lighter);
            border-radius: 15px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--secondary);
            background: rgba(15, 52, 96, 0.8);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.2);
        }

        .button {
            padding: 15px 35px;
            background: var(--gradient-warm);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(1);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .button:hover::before {
            width: 300%;
            height: 300%;
        }

        .button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.5);
        }

        .button:active {
            transform: translateY(-1px) scale(1.02);
        }

        .value-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 25px;
        }

        .value-tag {
            padding: 12px 22px;
            background: var(--surface-light);
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 500;
            animation: bounceIn 0.6s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative; /* For delete button positioning */
        }

        .value-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--secondary);
        }

        .value-tag.big3 {
            background: var(--gradient-warm);
            color: white;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .value-tag.big3::before {
            content: 'â­';
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: var(--gradient-1);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .stat-card:nth-child(2) {
            background: var(--gradient-2);
        }

        .stat-card:nth-child(3) {
            background: var(--gradient-3);
        }

        .stat-card:nth-child(4) {
            background: var(--gradient-warm);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            margin-top: 5px;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes sparkle {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-warm);
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .delete-button {
            display: none;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 107, 107, 0.2);
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 1.2rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .show-delete .delete-button {
            display: flex;
        }

        .delete-button:hover {
            background: var(--warning);
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        .emotion-record {
            padding: 15px 20px;
            background: var(--surface-lighter);
            border-radius: 15px;
            margin-top: 15px;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .emotion-record:hover {
            border-color: var(--secondary);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-warm);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-warm);
            color: white;
            padding: 18px 25px;
            border-radius: 15px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            animation: slideInRight 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000;
            max-width: 90%;
            word-wrap: break-word;
            font-weight: 500;
        }

        .notification.error {
            background: var(--gradient-2);
        }

        @keyframes slideInRight {
            from { 
                transform: translateX(120%);
                opacity: 0;
            }
            to { 
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from { 
                transform: translateX(0);
                opacity: 1;
            }
            to { 
                transform: translateX(120%);
                opacity: 0;
            }
        }

        @keyframes levelUpPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes levelUpFade {
            from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            to { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        @keyframes particleFly {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-500px) rotate(720deg); opacity: 0; }
        }

        /* --- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ & å°å‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2.2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .nav-button {
                font-size: 0.85rem;
                padding: 12px 15px;
                min-width: 70px;
            }
            .card {
                padding: 25px;
            }
            #record-now-btn {
                padding: 25px 50px;
                font-size: 1.6rem;
            }
        }
        
        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .header h1 {
                font-size: 2rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .card {
                padding: 20px;
            }
            .emotion-main-grid {
                grid-template-columns: 1fr; /* å¿«ãƒ»ä¸å¿«ãƒœã‚¿ãƒ³ã‚’ç¸¦ç©ã¿ã« */
                gap: 15px;
            }
            .emotion-button {
                padding: 30px;
                font-size: 2.5rem;
            }
            .emotion-button > span {
                font-size: 1.2rem;
            }
            .stats-grid {
                grid-template-columns: 1fr; /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã‚’ç¸¦ç©ã¿ã« */
            }
            .button {
                padding: 12px 30px;
                font-size: 1rem;
            }
             #record-now-btn {
                width: 100%;
                padding: 20px;
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ã”æ©Ÿå«Œãƒã‚¹ã‚¿ãƒ¼</h1>
            <p>èªçŸ¥ã¨éèªçŸ¥ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ•´ãˆã¦ã€ã”æ©Ÿå«Œãªæ¯æ—¥ã‚’</p>
        </div>

        <div class="navigation">
            <button class="nav-button active" data-section="emotion">æ„Ÿæƒ…ã«æ°—ã¥ã</button>
            <button class="nav-button" data-section="value">ã”æ©Ÿå«Œã®ä¾¡å€¤</button>
            <button class="nav-button" data-section="now">ä»Šã“ã“è‡ªåˆ†</button>
            <button class="nav-button" data-section="stats">çµ±è¨ˆ</button>
            <button class="nav-button" data-section="settings">è¨­å®š</button>
        </div>

        <!-- æ„Ÿæƒ…ã«æ°—ã¥ãã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="emotion-section" class="section active">
            <div class="card">
                <h2>ä»Šã®æ„Ÿæƒ…ã¯ï¼Ÿ</h2>
                <p style="color: var(--text-dim); margin-bottom: 25px;">
                    ã¾ãšã¯å¿«ã‹ä¸å¿«ã‹ã«æ°—ã¥ãã€è©³ã—ãè¨€èªåŒ–ã—ã¾ã—ã‚‡ã†
                </p>
                
                <div class="emotion-main-grid">
                    <button class="emotion-button" data-emoji="ğŸ˜Š" data-name="å¿«">
                        ğŸ˜Š<br><span>å¿«</span>
                    </button>
                    <button class="emotion-button" data-emoji="ğŸ˜”" data-name="ä¸å¿«">
                        ğŸ˜”<br><span>ä¸å¿«</span>
                    </button>
                </div>

                <div class="input-group">
                    <label>ã©ã‚“ãªå¿«/ä¸å¿«ï¼Ÿè©³ã—ãè¨€èªåŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†</label>
                    <textarea id="emotion-detail" rows="4" placeholder="ä¾‹ï¼šãƒ—ãƒ¬ã‚¼ãƒ³ãŒçµ‚ã‚ã£ã¦ãƒ›ãƒƒã¨ã—ãŸï¼ˆå¿«ï¼‰/ æ˜æ—¥ã®ä¼šè­°ã‚’è€ƒãˆã‚‹ã¨èƒ¸ãŒã‚¶ãƒ¯ã‚¶ãƒ¯ã™ã‚‹ï¼ˆä¸å¿«ï¼‰"></textarea>
                </div>

                <button class="button" id="save-emotion-btn">æ„Ÿæƒ…ã‚’è¨˜éŒ²ã™ã‚‹</button>

                <div id="emotion-history" style="margin-top: 35px;"></div>
            </div>
        </div>

        <!-- ã”æ©Ÿå«Œã®ä¾¡å€¤ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="value-section" class="section">
            <div class="card">
                <h2>ã”æ©Ÿå«Œã§ã„ã‚‹ã¨ä½•ãŒè‰¯ã„ï¼Ÿ</h2>
                <p style="color: var(--text-dim); margin-bottom: 25px;">
                    ä¾¡å€¤ãƒªã‚¹ãƒˆã¯ç´¯ç©ã•ã‚Œã¾ã™ã€‚10â†’30â†’50â†’100â†’300å€‹ã§ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼
                </p>

                <div class="input-group">
                    <label>ã”æ©Ÿå«Œã®ä¾¡å€¤ã‚’å…¥åŠ›</label>
                    <input type="text" id="value-input" placeholder="ä¾‹ï¼šã‚¢ã‚¤ãƒ‡ã‚¢ãŒæ¹§ã„ã¦ãã‚‹">
                </div>

                <button class="button" id="add-value-btn">ä¾¡å€¤ã‚’è¿½åŠ </button>

                <div id="value-progress-container" style="margin-top: 25px;">
                    <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¯ã“ã®ä¸­ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>

                <div id="value-list" class="value-list"></div>

                <div style="margin-top: 35px;">
                    <h3 style="color: var(--accent); margin-bottom: 10px;">ã‚ãªãŸã®ãƒ“ãƒƒã‚°3ã‚’é¸æŠ</h3>
                    <p style="color: var(--text-dim); font-size: 0.95rem;">ç‰¹ã«å¤§åˆ‡ãª3ã¤ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆä¾¡å€¤ã®ãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰</p>
                </div>
            </div>
        </div>

        <!-- ä»Šã“ã“è‡ªåˆ†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="now-section" class="section">
            <div class="card">
                <h2>ä»Šã“ã“è‡ªåˆ†</h2>
                <p style="color: var(--text-dim); margin-bottom: 30px;">
                    éå»ã§ã‚‚æœªæ¥ã§ã‚‚ãªãã€ä»Šã“ã®ç¬é–“ã«æ„è­˜ã‚’å‘ã‘ã¾ã—ã‚‡ã†
                </p>

                <button class="button" id="record-now-btn" style="font-size: 1.8rem; padding: 30px 60px; border-radius: 30px;">
                    ä»Šãƒ»ã“ã“ãƒ»è‡ªåˆ†
                </button>

                <div style="margin-top: 40px;">
                    <h3 style="color: var(--secondary); margin-bottom: 20px;">ä»Šã“ã“ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                    <div class="stat-card" style="background: var(--gradient-3);">
                        <div class="stat-number" id="now-count">0</div>
                        <div class="stat-label">ä»Šé€±ã®ã€Œä»Šã“ã“è‡ªåˆ†ã€å›æ•°</div>
                    </div>
                </div>

                <div style="margin-top: 40px; background: var(--surface-lighter); padding: 25px; border-radius: 15px;">
                    <h3 style="color: var(--accent); margin-bottom: 20px;">ç°¡å˜ãªç‘æƒ³ã‚¬ã‚¤ãƒ‰</h3>
                    <div style="line-height: 2;">
                        <p>ğŸŒ¸ 1. æ·±å‘¼å¸ã‚’3å›</p>
                        <p>ğŸŒ¸ 2. ã€Œä»Šã€ã¨å¿ƒã®ä¸­ã§å”±ãˆã‚‹</p>
                        <p>ğŸŒ¸ 3. ã€Œã“ã“ã€ã¨æ„è­˜ã‚’ä½“ã«å‘ã‘ã‚‹</p>
                        <p>ğŸŒ¸ 4. ã€Œè‡ªåˆ†ã€ã¨è‡ªåˆ†ã®å­˜åœ¨ã‚’æ„Ÿã˜ã‚‹</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="stats-section" class="section">
            <div class="card">
                <h2>ã‚ãªãŸã®ã”æ©Ÿå«Œçµ±è¨ˆ</h2>
                <p id="week-period" style="color: var(--text-dim); margin-bottom: 25px; font-size: 1.05rem;"></p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-emotions">0</div>
                        <div class="stat-label">ä»Šé€±ã®æ„Ÿæƒ…è¨˜éŒ²</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="positive-ratio">0%</div>
                        <div class="stat-label">ä»Šé€±ã®å¿«ã®å‰²åˆ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-values">0</div>
                        <div class="stat-label">ç´¯ç©ä¾¡å€¤ãƒªã‚¹ãƒˆ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="now-count-stats">0</div>
                        <div class="stat-label">ä»Šé€±ã®ä»Šã“ã“å›æ•°</div>
                    </div>
                </div>

                <div style="margin-top: 35px;">
                    <h3 style="color: var(--secondary); margin-bottom: 20px;">ä»Šé€±ã®å¿«ãƒ»ä¸å¿«ã®å†…è¨³</h3>
                    <div id="emotion-trend"></div>
                </div>

                <div style="margin-top: 35px;">
                    <h3 style="color: var(--accent); margin-bottom: 20px;">éå»ã®é€±ã®è¨˜éŒ²</h3>
                    <div id="history-weeks"></div>
                </div>
            </div>
        </div>

        <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="settings-section" class="section">
            <div class="card">
                <h2>è¨­å®š</h2>
                
                <div style="margin-bottom: 35px; background: var(--surface-lighter); padding: 25px; border-radius: 15px;">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;">ğŸ“ ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>
                    <p style="color: var(--text-dim); margin-bottom: 20px;">
                        ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã€å¾Œã§å¾©å…ƒã§ãã¾ã™
                    </p>
                    <button class="button" id="export-btn">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
                
                <div style="margin-bottom: 35px; background: var(--surface-lighter); padding: 25px; border-radius: 15px;">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ</h3>
                    <p style="color: var(--text-dim); margin-bottom: 20px;">
                        ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™
                    </p>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button class="button" id="import-btn">
                        ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                    </button>
                </div>
                
                <div style="background: rgba(255, 107, 107, 0.1); padding: 25px; border-radius: 15px; border: 2px solid rgba(255, 107, 107, 0.3);">
                    <h3 style="color: var(--warning); margin-bottom: 15px;">âš ï¸ ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚»ãƒƒãƒˆ</h3>
                    <p style="color: var(--text-dim); margin-bottom: 20px;">
                        å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆå…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰
                    </p>
                    <button class="button" id="reset-btn" style="background: var(--gradient-2);">
                        å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- åˆæœŸåŒ–ã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        let appData = loadData() || {
            emotions: [],
            values: [],
            big3: [],
            nowCount: 0,
            selectedEmotion: null,
            weeklyData: {
                current: getWeekKey(),
                history: {}
            }
        };

        function loadData() {
            try {
                const saved = localStorage.getItem('gokigenMasterData');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (!data.weeklyData) {
                        data.weeklyData = { current: getWeekKey(), history: {} };
                    }
                    return data;
                }
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
            return null;
        }

        function saveData() {
            try {
                localStorage.setItem('gokigenMasterData', JSON.stringify(appData));
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        function getWeekKey() {
            const now = new Date();
            const monday = new Date(now);
            const day = monday.getDay() || 7;
            monday.setDate(monday.getDate() - day + 1);
            monday.setHours(0, 0, 0, 0);
            const year = monday.getFullYear();
            const month = (monday.getMonth() + 1).toString().padStart(2, '0');
            const date = monday.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${date}`;
        }

        function checkWeeklyReset() {
            const currentWeek = getWeekKey();
            if (appData.weeklyData.current !== currentWeek) {
                if (appData.weeklyData.current) {
                    appData.weeklyData.history[appData.weeklyData.current] = {
                        emotions: [...appData.emotions],
                        values: [...appData.values],
                        big3: [...appData.big3],
                        nowCount: appData.nowCount,
                        endDate: new Date().toISOString()
                    };
                }
                appData.weeklyData.current = currentWeek;
                appData.nowCount = 0;
                appData.emotions = appData.emotions.filter(e => {
                    const emotionDate = new Date(e.timestamp);
                    const weekStart = new Date(currentWeek);
                    return emotionDate >= weekStart;
                });
                showNotification('âœ¨ æ–°ã—ã„é€±ãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼ä¾¡å€¤ãƒªã‚¹ãƒˆã¯ç¶™ç¶šã•ã‚Œã¾ã™ã€‚');
                saveData();
            }
        }

        // --- UIæ›´æ–°é–¢æ•° ---
        function showSection(sectionId) {
            checkWeeklyReset();
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));

            document.getElementById(`${sectionId}-section`).classList.add('active');
            document.querySelector(`.nav-button[data-section="${sectionId}"]`).classList.add('active');

            if (sectionId === 'stats') updateStats();
            if (sectionId === 'now') document.getElementById('now-count').textContent = appData.nowCount;
        }

        function displayEmotionHistory() {
            const history = document.getElementById('emotion-history');
            const weekStart = new Date(appData.weeklyData.current);
            const weeklyEmotions = appData.emotions.filter(e => new Date(e.timestamp) >= weekStart);
            const recent = weeklyEmotions.slice(0, 5);
            
            history.innerHTML = '<h3 style="color: var(--secondary); margin-bottom: 20px;">ä»Šé€±ã®æ„Ÿæƒ…è¨˜éŒ²</h3>' +
                (recent.length > 0 ? recent.map(e => `
                    <div class="emotion-record" data-timestamp="${e.timestamp}">
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 1.8rem;">${e.emoji}</span>
                            <div style="margin-left: 15px;">
                                <strong style="font-size: 1.1rem;">${e.name}</strong>
                                <span style="color: var(--text-dim); font-size: 0.85rem; display: block;">${e.displayTime || new Date(e.timestamp).toLocaleString('ja-JP')}</span>
                            </div>
                        </div>
                        ${e.detail ? `<p style="margin-top: 10px; line-height: 1.6; padding-left: 50px;">${e.detail}</p>` : ''}
                        <button class="delete-button">Ã—</button>
                    </div>
                `).join('') : '<p style="color: var(--text-dim); margin-top: 10px; text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>');
        }

        function displayValues() {
            const list = document.getElementById('value-list');
            list.innerHTML = appData.values.map((v, i) => 
                `<div class="value-tag ${appData.big3.includes(i) ? 'big3' : ''}" data-index="${i}">
                    <span>${v}</span>
                    <button class="delete-button">Ã—</button>
                </div>`
            ).join('');
            updateValueProgress();
        }
        
        function updateValueProgress() {
            const container = document.getElementById('value-progress-container');
            const count = appData.values.length;
            const nextReq = getNextLevelRequirement(count);
            const currentLevel = getValueLevel(count);
            const levelName = getLevelName(currentLevel);
            const levelEmojis = ['', 'ğŸ¥‰', 'ğŸ¥ˆ', 'ğŸ¥‡', 'ğŸ’', 'ğŸ‘‘'];
            
            let progress = 0;
            let progressText = '';
            
            if (nextReq) {
                const levelStarts = [0, 10, 30, 50, 100, 300];
                const currentLevelStart = levelStarts[currentLevel] || 0;
                progress = ((count - currentLevelStart) / (nextReq - currentLevelStart)) * 100;
                progressText = `æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ï¼š${nextReq - count}å€‹`;
            } else {
                progress = 100;
                progressText = 'ãƒã‚¹ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ«é”æˆï¼';
            }
            
            container.innerHTML = `
                <p style="font-size: 1.1rem; font-weight: 500; margin-bottom: 10px;">
                    ç´¯ç©ä¾¡å€¤ãƒªã‚¹ãƒˆï¼ˆ<span style="color: var(--accent); font-size: 1.3rem; font-weight: 700;">${count}</span>å€‹ï¼‰
                    <span style="margin-left: 20px; background: var(--gradient-warm); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                        ${levelEmojis[currentLevel]} ${levelName}
                    </span>
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%"></div>
                </div>
                <p style="color: var(--text-dim); font-size: 0.9rem; margin-top: 8px;">${progressText}</p>
            `;
        }

        function updateStats() {
            const weekStart = new Date(appData.weeklyData.current);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            document.getElementById('week-period').textContent = `ä»Šé€±ï¼š${weekStart.toLocaleDateString('ja-JP')} ã€œ ${weekEnd.toLocaleDateString('ja-JP')}`;

            const weeklyEmotions = appData.emotions.filter(e => new Date(e.timestamp) >= weekStart);
            document.getElementById('total-emotions').textContent = weeklyEmotions.length;
            
            const positiveCount = weeklyEmotions.filter(e => e.name === 'å¿«').length;
            const ratio = weeklyEmotions.length > 0 ? Math.round((positiveCount / weeklyEmotions.length) * 100) : 0;
            document.getElementById('positive-ratio').textContent = `${ratio}%`;
            
            const currentLevel = getValueLevel(appData.values.length);
            const levelName = getLevelName(currentLevel);
            const levelEmojis = ['', 'ğŸ¥‰', 'ğŸ¥ˆ', 'ğŸ¥‡', 'ğŸ’', 'ğŸ‘‘'];
            document.getElementById('total-values').innerHTML = `${appData.values.length}<br><span style="font-size: 0.8rem;">${levelEmojis[currentLevel]}${levelName}</span>`;
            document.getElementById('now-count-stats').textContent = appData.nowCount;
            
            const trend = document.getElementById('emotion-trend');
            if (weeklyEmotions.length > 0) {
                const negativeCount = weeklyEmotions.length - positiveCount;
                const positivePercent = (positiveCount / weeklyEmotions.length) * 100;
                trend.innerHTML = `
                    <div style="display: flex; justify-content: space-around; margin-bottom: 25px;">
                        <div style="text-align: center; background: var(--surface-lighter); padding: 25px; border-radius: 15px; flex: 1; margin-right: 10px;">
                            <div style="font-size: 2.5rem;">ğŸ˜Š</div><div style="font-size: 2rem; font-weight: 700; color: var(--success);">${positiveCount}å›</div><div style="color: var(--text-dim); font-weight: 500;">å¿«</div>
                        </div>
                        <div style="text-align: center; background: var(--surface-lighter); padding: 25px; border-radius: 15px; flex: 1; margin-left: 10px;">
                            <div style="font-size: 2.5rem;">ğŸ˜”</div><div style="font-size: 2rem; font-weight: 700; color: var(--warning);">${negativeCount}å›</div><div style="color: var(--text-dim); font-weight: 500;">ä¸å¿«</div>
                        </div>
                    </div>
                    <div class="progress-bar" style="height: 25px;"><div class="progress-fill" style="width: ${positivePercent}%; background: var(--gradient-3);"></div></div>
                    <p style="text-align: center; margin-top: 15px; color: var(--text); font-weight: 500;">å¿«ã®å‰²åˆ: ${Math.round(positivePercent)}%</p>`;
            } else {
                trend.innerHTML = '<p style="color: var(--text-dim); text-align: center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            }

            const historyWeeks = document.getElementById('history-weeks');
            const historyKeys = Object.keys(appData.weeklyData.history).sort().reverse();
            if (historyKeys.length > 0) {
                historyWeeks.innerHTML = historyKeys.map(weekKey => {
                    const weekData = appData.weeklyData.history[weekKey];
                    const weekStartHist = new Date(weekKey);
                    const weekEndHist = new Date(weekStartHist);
                    weekEndHist.setDate(weekEndHist.getDate() + 6);
                    const positiveCountHist = weekData.emotions.filter(e => e.name === 'å¿«').length;
                    const positiveRatioHist = weekData.emotions.length > 0 ? Math.round((positiveCountHist / weekData.emotions.length) * 100) : 0;
                    return `<div class="card" style="margin-top: 25px; background: var(--surface-lighter);">
                                <h4 style="color: var(--accent); margin-bottom: 20px; font-size: 1.2rem;">ğŸ“… ${weekStartHist.toLocaleDateString('ja-JP')} ã€œ ${weekEndHist.toLocaleDateString('ja-JP')}</h4>
                                <div class="stats-grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="stat-card" style="padding: 15px;"><div class="stat-number" style="font-size: 1.5rem;">${weekData.emotions.length}</div><div class="stat-label">æ„Ÿæƒ…è¨˜éŒ²</div></div>
                                    <div class="stat-card" style="padding: 15px;"><div class="stat-number" style="font-size: 1.5rem;">${positiveRatioHist}%</div><div class="stat-label">å¿«ã®å‰²åˆ</div></div>
                                    <div class="stat-card" style="padding: 15px;"><div class="stat-number" style="font-size: 1.5rem;">${weekData.values.length}</div><div class="stat-label">ç´¯ç©ä¾¡å€¤</div></div>
                                    <div class="stat-card" style="padding: 15px;"><div class="stat-number" style="font-size: 1.5rem;">${weekData.nowCount}</div><div class="stat-label">ä»Šã“ã“</div></div>
                                </div>
                            </div>`;
                }).join('');
            } else {
                historyWeeks.innerHTML = '<p style="color: var(--text-dim); text-align: center;">éå»ã®è¨˜éŒ²ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>';
            }
        }

        // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•° ---
        function saveEmotion() {
            if (!appData.selectedEmotion) {
                showNotification('ğŸ’­ æ„Ÿæƒ…ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            const detail = document.getElementById('emotion-detail').value;
            appData.emotions.unshift({
                ...appData.selectedEmotion,
                detail,
                timestamp: new Date().toISOString(),
                displayTime: new Date().toLocaleString('ja-JP')
            });
            displayEmotionHistory();
            document.querySelectorAll('.emotion-button').forEach(b => b.classList.remove('selected'));
            document.getElementById('emotion-detail').value = '';
            appData.selectedEmotion = null;
            showNotification('âœ¨ æ„Ÿæƒ…ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼');
            saveData();
        }
        
        function deleteEmotion(timestamp) {
            const index = appData.emotions.findIndex(e => e.timestamp === timestamp);
            if (index > -1) {
                appData.emotions.splice(index, 1);
                displayEmotionHistory();
                showNotification('å‰Šé™¤ã—ã¾ã—ãŸ');
                saveData();
            }
        }

        function addValue() {
            const input = document.getElementById('value-input');
            const value = input.value.trim();
            if (!value) return;
            if (appData.values.includes(value)) {
                showNotification('ğŸ’« ã™ã§ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™', 'error');
                return;
            }
            const previousLevel = getValueLevel(appData.values.length);
            appData.values.push(value);
            const newLevel = getValueLevel(appData.values.length);
            input.value = '';
            displayValues();
            if (newLevel > previousLevel) {
                showLevelUpEffect(newLevel);
            } else {
                showNotification('ğŸŒŸ ä¾¡å€¤ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
            }
            saveData();
        }

        function deleteValue(index) {
            appData.big3 = appData.big3.filter(i => i !== index).map(i => i > index ? i - 1 : i);
            appData.values.splice(index, 1);
            displayValues();
            showNotification('å‰Šé™¤ã—ã¾ã—ãŸ');
            saveData();
        }

        function toggleBig3(index) {
            const idx = appData.big3.indexOf(index);
            const tag = document.querySelector(`.value-tag[data-index="${index}"]`);

            if (idx > -1) {
                appData.big3.splice(idx, 1);
                if(tag) tag.classList.remove('big3');
            } else if (appData.big3.length < 3) {
                appData.big3.push(index);
                if(tag) tag.classList.add('big3');
            } else {
                showNotification('â­ ãƒ“ãƒƒã‚°3ã¯3ã¤ã¾ã§ã§ã™', 'error');
                return;
            }
            saveData();
        }
        
        function recordNowHere() {
            appData.nowCount++;
            document.getElementById('now-count').textContent = appData.nowCount;
            showNotification('ğŸŒ¸ ä»Šãƒ»ã“ã“ãƒ»è‡ªåˆ† ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
            saveData();
        }
        
        // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° (ãƒ¬ãƒ™ãƒ«ã€é€šçŸ¥ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ) ---
        function getValueLevel(count) {
            if (count >= 300) return 5; if (count >= 100) return 4; if (count >= 50) return 3;
            if (count >= 30) return 2; if (count >= 10) return 1; return 0;
        }
        function getLevelName(level) {
            return ['ãƒ“ã‚®ãƒŠãƒ¼', 'ãƒ–ãƒ­ãƒ³ã‚º', 'ã‚·ãƒ«ãƒãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‰', 'ãƒ—ãƒ©ãƒãƒŠ', 'ãƒã‚¹ã‚¿ãƒ¼'][level] || 'ãƒ“ã‚®ãƒŠãƒ¼';
        }
        function getNextLevelRequirement(currentCount) {
            const levels = [10, 30, 50, 100, 300];
            for (let req of levels) { if (currentCount < req) return req; }
            return null;
        }
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s forwards';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        function showLevelUpEffect(level) {
            const levelName = getLevelName(level);
            const levelEmojis = ['', 'ğŸ¥‰', 'ğŸ¥ˆ', 'ğŸ¥‡', 'ğŸ’', 'ğŸ‘‘'];
            const notification = document.createElement('div');
            notification.style.cssText = `position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--gradient-warm); color: white; padding: 40px 60px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); z-index: 3000; text-align: center; animation: levelUpPop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);`;
            notification.innerHTML = `<div style="font-size: 4rem; margin-bottom: 20px;">${levelEmojis[level]}</div><h2 style="font-size: 2rem; margin-bottom: 10px;">ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼</h2><p style="font-size: 1.5rem; font-weight: 700;">${levelName}</p>`;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'levelUpFade 0.5s ease-out forwards';
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        // --- è¨­å®šé–¢é€£ã®é–¢æ•° ---
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gokigen-master-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            a.remove();
            showNotification('ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    appData = imported;
                    saveData();
                    checkWeeklyReset();
                    initializeAppState();
                    showNotification('ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                } catch (error) {
                    showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        function resetAllData() {
            console.log("å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆãŒè¦æ±‚ã•ã‚Œã¾ã—ãŸã€‚å®‰å…¨ã®ãŸã‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã—ãŸã€‚");
            showNotification('ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã¯ç¾åœ¨ç„¡åŠ¹ã§ã™ã€‚', 'error');
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ---
        function setupEventListeners() {
            document.querySelector('.navigation').addEventListener('click', (e) => {
                if (e.target.matches('.nav-button')) {
                    showSection(e.target.dataset.section);
                }
            });

            document.querySelector('#emotion-section').addEventListener('click', (e) => {
                const button = e.target.closest('.emotion-button');
                if (button) {
                    document.querySelectorAll('.emotion-button').forEach(b => b.classList.remove('selected'));
                    button.classList.add('selected');
                    appData.selectedEmotion = { emoji: button.dataset.emoji, name: button.dataset.name };
                }
            });
            document.getElementById('save-emotion-btn').addEventListener('click', saveEmotion);

            document.getElementById('add-value-btn').addEventListener('click', addValue);
            document.getElementById('value-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addValue();
            });
            
            document.getElementById('record-now-btn').addEventListener('click', recordNowHere);

            document.getElementById('export-btn').addEventListener('click', exportData);
            document.getElementById('import-btn').addEventListener('click', () => document.getElementById('import-file').click());
            document.getElementById('import-file').addEventListener('change', importData);
            document.getElementById('reset-btn').addEventListener('click', resetAllData);

            document.body.addEventListener('click', (event) => {
                const target = event.target;
                const valueTag = target.closest('.value-tag');
                const emotionRecord = target.closest('.emotion-record');
                const clickedItem = valueTag || emotionRecord;

                document.querySelectorAll('.show-delete').forEach(el => {
                    if (el !== clickedItem) el.classList.remove('show-delete');
                });
                
                if (!clickedItem) return;

                if (target.matches('.delete-button')) {
                    if (valueTag) deleteValue(parseInt(valueTag.dataset.index, 10));
                    if (emotionRecord) deleteEmotion(emotionRecord.dataset.timestamp);
                    return;
                }

                if (valueTag) {
                    toggleBig3(parseInt(valueTag.dataset.index, 10));
                }
                
                clickedItem.classList.toggle('show-delete');
            });
        }
        
        // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– ---
        function initializeAppState() {
            checkWeeklyReset();
            displayEmotionHistory();
            displayValues();
        }
        
        initializeAppState();
        setupEventListeners();

    </script>
</body>
</html>


</body>
</html>
